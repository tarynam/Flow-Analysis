---
title: "ICS_HC"
author: "Taryn McLaughlin"
date: "6/2/2019"
output: html_document
---
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, error=TRUE, message=FALSE, warning=FALSE, comment=NA)
library(dplyr)
library(knitr)
library(ggplot2)
library(gridExtra)
library(GGally)
library(ggpubr)
library(cowplot)
```

```{r source}
source("/Users/tarynam/Desktop/Miscellaneous-Scripts/tryna function.R")
source("/Users/tarynam/Desktop/Miscellaneous-Scripts/pvals_TB-SM.R")
source("/Users/tarynam/Desktop/Miscellaneous-Scripts/plot_functions.R")
source("/Users/tarynam/Desktop/Miscellaneous-Scripts/comp_hc_ltbi.R")
```

```{r}
setwd("/Applications/Old Computer/Day Lab/Flow-Data/clean/")
cd4<-read.csv("ICS_CD4_clean.csv")

CD4<-plot_filter(read.csv("ICS_CD4_Cytokine_clean.csv"))

phen<-read.csv("ICS_CD4_phenotyping_clean_NAs.csv")
```

#Are HC and LTBI different or can we combine?

##Lineage Markers on UN

```{r, fig.height=3, fig.width=6}
library(knitr)
colnames<-names(dplyr::select(cd4, -X, -Sample, -Donor, -Stim, -TB, -SM))
df<-filter(cd4, Stim=="UN")
df<-mutate_hc(df)
for(col in colnames){
    print(col)
    print(pvals_hc(df, col))
    grid.arrange(
       plot_hc(df[df$QFT=="QFT-",], "SM", col)+labs(title="QFT- Only"), 
       plot_hc(df, "SM", col)+labs(title="All Healthy Controls"),
       ncol=2
    )
}
```

##Cytokine Analysis from PMA

```{r, fig.height=3, fig.width=6}
library(knitr)
colnames<-names(dplyr::select(CD4, -X, -Sample, -Donor, -Stim, -TB, -SM))
df<-filter(CD4, Stim=="PMA")
df<-mutate_hc(df)
for(col in colnames){
    print(col)
    print(pvals_hc(df, col))
    grid.arrange(
       plot_hc(df[df$QFT=="QFT-",], "SM", col)+labs(title="QFT- Only"), 
       plot_hc(df, "SM", col)+labs(title="All Healthy Controls"),
       ncol=2
    )
}
```

#Phenotype from PMA
```{r, fig.height=3, fig.width=6}
library(knitr)
colnames<-names(dplyr::select(phen, -X.1, -X, -id, -Sample, -Donor, -Stim, -TB, -SM))
df<-filter(phen, Stim=="PMA")
df<-mutate_hc(df)
for(col in colnames){
    print(col)
    print(pvals_hc(df, col))
    grid.arrange(
       plot_hc(df[df$QFT=="QFT-",], "SM", col)+labs(title="QFT- Only"), 
       plot_hc(df, "SM", col)+labs(title="All Healthy Controls"),
       ncol=2
    )
}
```

##Actual analysis